@page
@using MHFoodBank.Common
@using MHFoodBank.Common.Dtos
@using System.Web
@model MHFoodBank.Web.Areas.Admin.Pages.AdminCalendar
@{
    Layout = "Shared/_Layout";
    ViewData["Title"] = "Admin Calendar";
}

@section Styles {
    <link href='~/fullcalendar/packages/core/main.css' rel='stylesheet' />
    <link href='~/fullcalendar/packages/daygrid/main.css' rel='stylesheet' />
    <link href='~/fullcalendar/packages/timegrid/main.css' rel='stylesheet' />
    <link href='~/fullcalendar/packages/list/main.css' rel='stylesheet' />
    <link href="~/css/admincalendar.css" rel="stylesheet" />
    <link href="~/lib/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.css" rel="stylesheet" />
}

@section Scripts {
    <script src='~/fullcalendar/packages/core/main.js'></script>
    <script src='~/fullcalendar/packages/interaction/main.js'></script>
    <script src='~/fullcalendar/packages/daygrid/main.js'></script>
    <script src='~/fullcalendar/packages/timegrid/main.js'></script>
    <script src='~/fullcalendar/packages/list/main.js'></script>
    <script src="~/fullcalendar/vendor/rrule.js"></script>
    <script src="~/fullcalendar/packages/rrule/main.js"></script>
}
<script src="~/js/admincalendar_events_recurring.js"></script>
<script src="~/js/admincalendar_ui.js"></script>
<script src="~/js/admincalendar_events_main.js"></script>
<script src="~/js/admincalendar_events_single.js"></script>
<script src="~/js/admincalendar_validate.js"></script>

<script>
    $('.shift-form').validate({
        rules: {
            RecurrenceSetStartDate: {
                compareDates: ['add-shift-date', 'add-recshift-enddate']
            }
        }
    });

    // calendar stuff
    document.addEventListener('DOMContentLoaded', function () {
        let calendarEl = document.getElementById('calendar');
        let calendar = new FullCalendar.Calendar(calendarEl, {
            timeZone: 'local',
            height: 725,
            nowIndicator: true,
            plugins: ['interaction', 'dayGrid', 'timeGrid', 'list', 'rrule'],
            header: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek'
            },
            navLinks: true, // can click day/week names to navigate views
            selectable: true,
            selectMirror: true,
            allDaySlot: false,
            firstDay: 0,
            eventClick: function (shiftInfo) {
                handleEventClick(shiftInfo)
            },
            select: function (arg) {
                $('#add-shift-modal').modal();
                startDate = moment(arg.start);
                endDate = moment(arg.end);

                $('#dtp-admincalendar-shift-end').datetimepicker('minDate', startDate)
                $('#dtp-admincalendar-shift-start').datetimepicker('maxDate', endDate)

                document.getElementById("add-shift-date").value = moment(startDate).format('yyyy-MM-DD');
                document.getElementById("add-recshift-enddate").value = moment(endDate).format('yyyy-MM-DD');

                let startTime;
                let endTime;

                if (arg.startStr.indexOf('T') < 0 || arg.endStr.indexOf('T') < 0) {
                    // if an initial time isn't given via drag controls, set default times
                    startTime = moment({ h: 8 }).format('HH:mm');
                    endTime = moment({ h: 16, m: 30 }).format('HH:mm');
                }
                else {
                    startTime = moment(startDate).format('HH:mm');
                    endTime = moment(endDate).format('HH:mm');
                }

                $('#dtp-shift-add-endtime').datetimepicker('minDate', startTime);
                $('#dtp-shift-add-starttime').datetimepicker('maxDate', endTime);

                document.getElementById("add-shift-starttime").value = startTime;
                document.getElementById("add-shift-endtime").value = endTime;

                calendar.unselect();
            },
            weekNumbers: true,
            weekNumbersWithinDays: true,
            weekNumberCalculation: 'ISO',
            eventLimit: true, // allow "more" link when too many events
            eventSources: [
                {
                    events: [
                        @foreach (var s in Model.Shifts.Where(s => s.Volunteer != null))
                        {
                            <text>
                                {
                                    id: '@s.Id',
                                    title: '@s.Description',
                                    @if (s.RecurrenceRule != null)
                                    {
                                        <text>
                                    // rrule converts the end date into utc here, so a one day offset is applied, see line 90 in RecurringShift.cs
                                            rrule: '@s.RecurrenceRule',
                                            duration: '@((s.EndTime - s.StartTime).ToString())',
                                        </text>
                                    }
                                    else
                                    {
                                        <text>
                                            start: '@s.StartDate.ToString("yyyy-MM-dd")@{string y = "T";@y}@s.StartTime',
                                            end: '@s.StartDate.ToString("yyyy-MM-dd")@y@s.EndTime',
                                        </text>
                                    }

                                    posWorked: '@(s.PositionWorked.Name)',
                                    vol: '@s.Volunteer.FullNameWithID',
                                    // this is set so that the recurring shift modal is displayed even though this is an individual shift
                                    wasPartOfRecurring: '@s.ParentRecurringShiftId'

                                },
                            </text>
                        }
                    ],
                },
                {
                    events: [
                        @foreach (var s in Model.Shifts.Where(s => s.Volunteer == null))
                            {
                            <text>
                                {
                                    id: '@s.Id',
                                    title: '@s.Description',
                                    @if (s.RecurrenceRule != null)
                                    {
                                        <text>
                                            rrule: '@s.RecurrenceRule',
                                            duration: '@((s.EndTime - s.StartTime).ToString())',
                                        </text>
                                    }
                                    else
                                    {
                                        <text>
                                            start: '@s.StartDate.ToString("yyyy-MM-dd")@{string y = "T"; @y}@s.StartTime',
                                            end: '@s.StartDate.ToString("yyyy-MM-dd")@y@s.EndTime',
                                        </text>
                                    }
                                    posWorked: '@(s.PositionWorked.Name)',
                                    vol: 'Open',
                                    wasPartOfRecurring: '@s.ParentRecurringShiftId'
                                },
                            </text>
                            }
                    ],
                    color: '#06A893',
                }
            ],
            eventTimeFormat: {
                hour: "2-digit",
                minute: "2-digit",
                meridiem: false,
                hour12: false
            }
        });
        calendar.render();
        $('#calendar').addClass("h-75");
    });

</script>
<div class="ml-5 mr-5">
    <partial name="_AdminStatusMessage" for="StatusMessage" />
    <form method="post" id="container">
        @if (String.IsNullOrWhiteSpace(Model.SearchedName))
        {
            <input id="search-name" class="form-control" placeholder="Search by name..." asp-for="@Model.SearchedName" />
        }
        else
        {
            <input id="search-name" class="form-control" value="@Model.SearchedName" asp-for="@Model.SearchedName" />
        }
        <select id="search-position" class="form-control" asp-items="@(new SelectList(Model.Positions, "Id", "Name", Model.SearchedPositionId))" asp-for="@Model.SearchedPositionId" required>
        </select>
        <button id="search" class="btn btn-primary" asp-page-handler="Search"><i class="fas fa-search"></i></button>
        <div class="btn-group" id="main-buttons">
            <button id="email" asp-page-handler="SendNotifications" class="btn btn-primary">Send Email</button>
            <div onclick="autoFillShiftModal()" class="btn btn-primary"><i class="fas fa-plus"></i> Shift</div>
            <div onclick="$('#add-position-modal').modal();" class="btn btn-primary"><i class="fas fa-plus"></i> Position</div>
            <div onclick="$('#edit-position-modal').modal();" class="btn btn-primary">
                <i class="fa fa-edit"></i> Positions
            </div>
        </div>
    </form>
    <hr />
    <div id='calendar'></div>
</div>

<!--modal for adding a new position-->
<form class="shift-form" method="post">
    <div id="add-position-modal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 id="modalTitle" class="modal-title">Add Position</h4>
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span> <span class="sr-only">Close</span></button>
                </div>
                <div id="modalBody" class="modal-body">
                    <label style="margin-top: 3px; padding-right: 10px;" for="position-add">New Name for Position</label>
                    <input type="text" class="form-control" id="add-position-name" asp-for="@Model.NewPositionName" required>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" asp-page-handler="AddPosition">Add</button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</form>

<!--modal for editing a new position-->
<form class="shift-form" method="post">
    <div id="edit-position-modal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 id="modalTitle" class="modal-title">Edit Position</h4>
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span> <span class="sr-only">Close</span></button>
                </div>
                <div id="modalBody" class="modal-body">
                    <label style="margin-top: 3px; padding-right: 10px;" for="edit-position-original">Position</label>
                    <input class="form-control"
                           type="text"
                           id="edit-position-original"
                           asp-for="@Model.SelectedPositionName"
                           list="positions"
                           placeholder="Select a position..."
                           required>
                    <br />
                    <label style="margin-top: 3px; padding-right: 10px;" for="">New Position Name</label>
                    <input type="text" class="form-control" id="edit-position-name" asp-for="@Model.NewPositionName">
                </div>
                <hr />
                <div class="modal-footer">
                    <button class="btn btn-primary" asp-page-handler="EditPosition">Submit Changes</button>
                    <button class="btn btn-danger" asp-page-handler="RemovePosition">Remove</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</form>

<!--modal for adding a shift-->
<form class="shift-form" method="post">
    <div id="add-shift-modal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 id="modalTitle" class="modal-title">Add Shift</h4>
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span> <span class="sr-only">close</span></button>
                </div>
                <div id="modalBody" class="modal-body">
                    <label style="margin-top: 3px; padding-right: 10px;" for="add-shift-date">Shift Date</label>
                    @*<input type="date" class="form-control" id="add-shift-date" asp-for="@Model.SelectedShift.StartDate">*@

                    <div>
                        <div class="input-group date datetimepicker-date-start" id="dtp-admincalendar-shift-start" data-target-input="nearest">
                            <input id="add-shift-date" type="text" class="form-control datetimepicker-input" asp-for="@Model.SelectedShift.StartDate" data-target="#dtp-admincalendar-shift-start" />
                            <div class="input-group-append" data-target="#dtp-admincalendar-shift-start" data-toggle="datetimepicker">
                                <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                            </div>
                        </div>
                    </div>

                    <br />
                    <div>
                        <input onclick="toggleAddRecurringShiftControls()" type="checkbox" id="add-recshift-display" name="dateRecurr">
                        <label class="form-check-label" for="dateRecurr">Make this shift a recurring shift</label>
                    </div>
                    <hr />
                    <div id="add-recshift-container" style="display: none">

                        <label style="margin-top: 3px; padding-right: 10px;" for="add-recshift-enddate">End Date</label>
                        @*<input type="date" class="form-control dtp-notype" id="add-recshift-enddate" value="@DateTime.Now.Date.ToString("yyyy-MM-dd")" asp-for="@Model.SelectedShift.EndDate">
            <span asp-validation-for="@Model.SelectedShift.EndDate" class="text-danger"></span>*@

                        <div>
                            <div class="input-group date datetimepicker-date-end" id="dtp-admincalendar-shift-end" data-target-input="nearest">
                                <input id="add-recshift-enddate" type="text" class="form-control datetimepicker-input" asp-for="@Model.SelectedShift.EndDate" data-target="#dtp-admincalendar-shift-end" />
                                <div class="input-group-append" data-target="#dtp-admincalendar-shift-end" data-toggle="datetimepicker">
                                    <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                </div>
                            </div>
                        </div>

                        <hr />

                        <label id="lblSelectDays" style="margin-top: 3px; padding-right: 10px;">Select Days of Week</label>
                        <div class="col-md-6 form-check">
                            <input id="add-recshift-weekday-sunday" asp-for="Sunday" />
                            <label class="form-check-label">Sunday</label>
                        </div>
                        <div class="col-md-6 form-check">
                            <input id="add-recshift-weekday-monday" asp-for="Monday" />
                            <label class="form-check-label">Monday</label>
                        </div>
                        <div class="col-md-6 form-check">
                            <input id="add-recshift-weekday-tuesday" asp-for="Tuesday" />
                            <label class="form-check-label">Tuesday</label>
                        </div>
                        <div class="col-md-6 form-check">
                            <input id="add-recshift-weekday-wednesday" asp-for="Wednesday" />
                            <label class="form-check-label">Wednesday</label>
                        </div>
                        <div class="col-md-6 form-check">
                            <input id="add-recshift-weekday-thursday" asp-for="Thursday" />
                            <label class="form-check-label">Thursday</label>
                        </div>
                        <div class="col-md-6 form-check">
                            <input id="add-recshift-weekday-friday" asp-for="Friday" />
                            <label class="form-check-label">Friday</label>
                        </div>
                        <div class="col-md-6 form-check">
                            <input id="add-recshift-weekday-saturday" asp-for="Saturday" />
                            <label class="form-check-label">Saturday</label>
                        </div>
                        <hr />
                    </div>
                    <label style="margin-top: 3px; padding-right: 10px;">Start Time</label>

                    @*<input type="text" class="form-control datetimepicker-time" id="add-shift-starttime" asp-for="@Model.SelectedShift.StartTime" required>*@
                    <div class="form-group">
                        <div class="input-group date datetimepicker-time-start" id="dtp-shift-add-starttime" data-target-input="nearest">
                            <input id="add-shift-starttime" type="text" class="form-control datetimepicker-input" asp-for="@Model.SelectedShift.StartTime" data-target="#dtp-shift-add-starttime" />
                            <div class="input-group-append" data-target="#dtp-shift-add-starttime" data-toggle="datetimepicker">
                                <div class="input-group-text"><i class="far fa-clock"></i></div>
                            </div>
                        </div>
                    </div>

                    <br />
                    <label style="margin-top: 3px; padding-right: 10px;">End Time</label>

                    @*<input type="text" class="form-control" id="add-shift-endtime" asp-for="@Model.SelectedShift.EndTime" required>*@
                    <div class="form-group">
                        <div class="input-group date datetimepicker-time-end" id="dtp-shift-add-endtime" data-target-input="nearest">
                            <input id="add-shift-endtime" type="text" class="form-control datetimepicker-input" asp-for="@Model.SelectedShift.EndTime" data-target="#dtp-shift-add-endtime" />
                            <div class="input-group-append" data-target="#dtp-shift-add-endtime" data-toggle="datetimepicker">
                                <div class="input-group-text"><i class="far fa-clock"></i></div>
                            </div>
                        </div>
                    </div>

                    <hr />
                    <div>
                        <input id="open-shift-add" type="checkbox" onclick="setShiftAsOpenAdd()" />
                        <label class="form-check-label">Make this shift open</label>
                    </div>
                    <br />
                    <div id="volunteer-container-add">
                        <label style="margin-top: 3px; padding-right: 10px;">Select Volunteer</label>
                        <input class="form-control"
                               type="text"
                               id="add-shift-volunteer"
                               asp-for="@Model.SelectedShiftVolunteer"
                               list="volunteers"
                               placeholder="Select a volunteer..."
                               required>
                    </div>
                    <hr />
                    <label style="margin-top: 3px; padding-right: 10px;">Position Worked</label>
                    <input class="form-control"
                           type="text"
                           id="add-shift-position"
                           asp-for="@Model.SelectedShiftPosition"
                           list="positions"
                           placeholder="Select a position..."
                           required>
                </div>
                <div class="modal-footer">
                    <button id="add-recshift-submit" style="display: none;" class="btn btn-primary" asp-page-handler="AddRecurringShift">Add</button>
                    <button id="add-shift-submit" class="btn btn-primary" asp-page-handler="AddShift">Add</button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</form>

<!--modal for editing a shift-->
<form class="shift-form" method="post">
    <div id="edit-shift-modal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Edit Shift</h4>
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span> <span class="sr-only">Close</span></button>
                </div>
                <div id="modalBody" class="modal-body">
                    <input type="hidden" id="edit-shift-id" asp-for="@Model.SelectedShift.Id">
                    <label style="margin-top: 3px; padding-right: 10px;">Shift Date</label>
                    @*<input asp-for="@Model.SelectedShift.StartDate" type="date" class="form-control" id="edit-shift-date" required>*@

                    <div>
                        <div class="input-group date datetimepicker-date-start" id="dtp-admincalendar-edit-shift-date" data-target-input="nearest">
                            <input id="edit-shift-date" type="text" class="form-control datetimepicker-input" asp-for="@Model.SelectedShift.StartDate" data-target="#dtp-admincalendar-edit-shift-date" />
                            <div class="input-group-append" data-target="#dtp-admincalendar-edit-shift-date" data-toggle="datetimepicker">
                                <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                            </div>
                        </div>
                    </div>

                    <hr />

                    <label style="margin-top: 3px; padding-right: 10px;">Start Time</label>
                    @*<input asp-for="@Model.SelectedShift.StartTime" type="text" class="time form-control" id="edit-shift-starttime" required>*@

                    <div class="form-group">
                        <div class="input-group date datetimepicker-time-start" id="dtp-shift-edit-starttime" data-target-input="nearest">
                            <input id="edit-shift-starttime" type="text" class="form-control datetimepicker-input" asp-for="@Model.SelectedShift.StartTime" data-target="#dtp-shift-edit-starttime" />
                            <div class="input-group-append" data-target="#dtp-shift-edit-starttime" data-toggle="datetimepicker">
                                <div class="input-group-text"><i class="far fa-clock"></i></div>
                            </div>
                        </div>
                    </div>

                    <hr />

                    <label style="margin-top: 3px; padding-right: 10px;">End Time</label>
                    @*<input asp-for="@Model.SelectedShift.EndTime" type="text" class="time form-control" id="edit-shift-endtime" value="" required>*@

                    <div class="form-group">
                        <div class="input-group date datetimepicker-time-end" id="dtp-shift-edit-endtime" data-target-input="nearest">
                            <input id="edit-shift-endtime" type="text" class="form-control datetimepicker-input" asp-for="@Model.SelectedShift.EndTime" data-target="#dtp-shift-edit-endtime" />
                            <div class="input-group-append" data-target="#dtp-shift-edit-endtime" data-toggle="datetimepicker">
                                <div class="input-group-text"><i class="far fa-clock"></i></div>
                            </div>
                        </div>
                    </div>

                    <hr />
                    <label style="margin-top: 3px; padding-right: 10px;">Position Worked</label>
                    <input class="form-control"
                           type="text"
                           id="edit-shift-position"
                           asp-for="@Model.SelectedShiftPosition"
                           list="positions"
                           required>

                    <hr />
                    <div>
                        <input id="open-shift-edit" type="checkbox" onclick="setShiftAsOpenEdit()" />
                        <label class="form-check-label">Make shift open</label>
                    </div>
                    <br />
                    <div id="volunteer-container-edit">
                        <label style="margin-top: 3px; padding-right: 10px;">Select Volunteer</label>
                        <input class="form-control"
                               type="text"
                               id="edit-shift-volunteer"
                               asp-for="@Model.SelectedShiftVolunteer"
                               list="volunteers"
                               required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" asp-page-handler="EditShift">Submit Change</button>
                    <div class="btn btn-danger" id="edit-shift-delete-prompt" onclick="handleDeletePrompt()">Delete</div>
                    <button class="btn btn-danger" id="edit-shift-delete-noprompt" asp-page-handler="DeleteShift">Delete</button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</form>

<!--modal for editing a recurring shift-->
<form class="shift-form" method="post">
    <div id="edit-recshift-modal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Edit Recurring Shift</h4>
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span> <span class="sr-only">Close</span></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="edit-recshift-id" asp-for="@Model.SelectedShift.Id">
                    <label id="edit-recshift-startdate-label" style="margin-top: 3px; padding-right: 10px;">Shift Date</label>

                    @*<input type="text" class="form-control" id="edit-recshift-single-final-startdate" asp-for="@Model.SelectedShift.StartDate" required>*@

                    <div>
                        <div class="input-group date datetimepicker-date-start" id="dtp-admincalendar-edit-recshift-single-date" data-target-input="nearest">
                            <input type="text" class="form-control datetimepicker-input" id="edit-recshift-single-final-startdate" asp-for="@Model.SelectedShift.StartDate" data-target="#dtp-admincalendar-edit-recshift-single-date" required>                            
                            <div class="input-group-append" data-target="#dtp-admincalendar-edit-recshift-single-date" data-toggle="datetimepicker">
                                <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                            </div>
                        </div>
                    </div>

                    <input type="hidden" id="edit-recshift-single-initial-startdate" asp-for="@Model.OriginalStartDate" required>

                    <div>
                        <div class="input-group date datetimepicker-date-start" style="display: none;" id="dtp-admincalendar-edit-recshift-all-date" data-target-input="nearest">
                            <input type="text" class="form-control datetimepicker-input" id="edit-recshift-all-startdate" asp-for="@Model.RecurrenceSetStartDate" data-target="#dtp-admincalendar-edit-recshift-all-date" required>
                            <div class="input-group-append" data-target="#dtp-admincalendar-edit-recshift-all-date" data-toggle="datetimepicker">
                                <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                            </div>
                        </div>
                    </div>

                    <hr />

                    <div>
                        <input onclick="toggleEditRecurringShiftControls()" type="radio" id="edit-recshift-display-single" asp-for="@Model.EditType" value="0" checked>
                        <label style="display: inline;" class="form-check-label">Selected Shift</label>
                        <input onclick="toggleEditRecurringShiftControls()" type="radio" id="edit-recshift-display-all" asp-for="@Model.EditType" value="1">
                        <label style="display: inline;" class="form-check-label">All Shifts</label>
                    </div>

                    <hr />

                    <div id="edit-recshift-container" style="display: none">

                        <label style="margin-top: 3px; padding-right: 10px;">End Recurring Set Date</label>
                        @*<input type="date" class="form-control" id="edit-recshift-enddate" asp-for="@Model.SelectedShift.EndDate" required>*@

                        <div>
                            <div class="input-group date datetimepicker-date-end" id="dtp-admincalendar-edit-recshift-enddate" data-target-input="nearest">
                                <input type="text" class="form-control datetimepicker-input" id="edit-recshift-enddate" asp-for="@Model.SelectedShift.EndDate" data-target="#dtp-admincalendar-edit-recshift-enddate" required>
                                <div class="input-group-append" data-target="#dtp-admincalendar-edit-recshift-enddate" data-toggle="datetimepicker">
                                    <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                </div>
                            </div>
                        </div>

                        <hr />

                        <label style="margin-top: 3px; padding-right: 10px;">Select Days of Week</label>

                        <div class="col-md-6 form-check">
                            <input id="edit-recshift-weekday-sunday" asp-for="Sunday" />
                            <label class="form-check-label">Sunday</label>
                        </div>

                        <div class="col-md-6 form-check">
                            <input id="edit-recshift-weekday-monday" asp-for="Monday" />
                            <label class="form-check-label">Monday</label>
                        </div>

                        <div class="col-md-6 form-check">
                            <input id="edit-recshift-weekday-tuesday" asp-for="Tuesday" />
                            <label class="form-check-label">Tuesday</label>
                        </div>

                        <div class="col-md-6 form-check">
                            <input id="edit-recshift-weekday-wednesday" asp-for="Wednesday" />
                            <label class="form-check-label">Wednesday</label>
                        </div>

                        <div class="col-md-6 form-check">
                            <input id="edit-recshift-weekday-thursday" asp-for="Thursday" />
                            <label class="form-check-label">Thursday</label>
                        </div>

                        <div class="col-md-6 form-check">
                            <input id="edit-recshift-weekday-friday" asp-for="Friday" />
                            <label class="form-check-label">Friday</label>
                        </div>

                        <div class="col-md-6 form-check">
                            <input id="edit-recshift-weekday-saturday" asp-for="Saturday" />
                            <label class="form-check-label">Saturday</label>
                        </div>

                        <hr />
                    </div>

                    <label style="margin-top: 3px; padding-right: 10px;">Start Time</label>
                    @*<input type="text" class="time form-control" id="edit-recshift-starttime" asp-for="@Model.SelectedShift.StartTime" required>*@

                    <div class="form-group">
                        <div class="input-group date datetimepicker-time-start" id="dtp-recshift-edit-starttime" data-target-input="nearest">
                            <input id="edit-recshift-starttime" type="text" class="form-control datetimepicker-input" asp-for="@Model.SelectedShift.StartTime" data-target="#dtp-recshift-edit-starttime" />
                            <div class="input-group-append" data-target="#dtp-recshift-edit-starttime" data-toggle="datetimepicker">
                                <div class="input-group-text"><i class="far fa-clock"></i></div>
                            </div>
                        </div>
                    </div>

                    <hr />

                    <label style="margin-top: 3px; padding-right: 10px;">End Time</label>
                    @*<input type="text" class="time form-control" id="edit-recshift-endtime" asp-for="@Model.SelectedShift.EndTime" required>*@

                    <div class="form-group">
                        <div class="input-group date datetimepicker-time-end" id="dtp-recshift-edit-endtime" data-target-input="nearest">
                            <input id="edit-recshift-endtime" type="text" class="form-control datetimepicker-input" asp-for="@Model.SelectedShift.EndTime" data-target="#dtp-recshift-edit-endtime" />
                            <div class="input-group-append" data-target="#dtp-recshift-edit-endtime" data-toggle="datetimepicker">
                                <div class="input-group-text"><i class="far fa-clock"></i></div>
                            </div>
                        </div>
                    </div>

                    <hr />
                    <label style="margin-top: 3px; padding-right: 10px;">Position Worked</label>
                    <input class="form-control"
                           type="text"
                           id="edit-recshift-position"
                           asp-for="@Model.SelectedShiftPosition"
                           list="positions"
                           required>
                    <hr />
                    <div>
                        <input id="open-shift-edit-rec" type="checkbox" onclick="setRecurringShiftAsOpen()" />
                        <label class="form-check-label">Make shift open</label>
                    </div>
                    <br />
                    <div id="volunteer-container-edit-rec">
                        <label style="margin-top: 3px; padding-right: 10px;">Select Volunteer</label>
                        <input class="form-control"
                               type="text"
                               id="edit-recshift-volunteer"
                               asp-for="@Model.SelectedShiftVolunteer"
                               list="volunteers"
                               required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" asp-page-handler="EditRecurringShift">Submit Change</button>
                    <button class="btn btn-danger" asp-page-handler="DeleteRecurringShift">Delete</button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</form>

<!--modal for choosing between deleting a individual recshift completely or returning it to original-->
<form class="shift-form" method="post">
    <input type="hidden" id="edit-recshift-single-confirm-id" asp-for="@Model.SelectedShift.Id" />
    <div id="edit-recshift-single-confirm" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 id="modalTitle" class="modal-title">Attention</h4>
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span> <span class="sr-only">Close</span></button>
                </div>
                <div id="modalBody" class="modal-body">
                    <p>This shift is part of a recurring set of shifts but its properties were changed from their original values.</p>
                    <p>Would you like to completely delete this shift or restore its original properties?</p>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" asp-page-handler="RestoreShiftPropertiesToOriginal">Restore Properties</button>
                    <button class="btn btn-danger" asp-page-handler="DeleteShiftFromRecurringSet">Delete</button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal" onclick="handleDeletePromptDismiss()">Cancel</button>
                </div>
            </div>
        </div>
    </div>
</form>

<datalist id="volunteers" ></datalist>
<datalist id="positions" ></datalist>

<script>

    $('.datetimepicker-time-start').datetimepicker({
        format: 'HH:mm',
    });

    $('.datetimepicker-time-end').datetimepicker({
        format: 'HH:mm',
    });

    $('.datetimepicker-date-start').datetimepicker({
        format: 'YYYY-MM-DD',
    });

    $('.datetimepicker-date-end').datetimepicker({
        format: 'YYYY-MM-DD',
    });

    let volunteers = new Array();
    @foreach (var volunteer in Model.Volunteers)
    {
        <text>volunteers.push('</text>@volunteer.FullNameWithID<text>');</text>
    }

    let options = '';

    for (var i = 0; i < volunteers.length; i++) {
        options += '<option value="' + volunteers[i] + '">';
    }

    document.getElementById('volunteers').innerHTML = options;

    let positions = new Array();
    @foreach (var position in Model.Positions.Where(p => p.Name != "All" && !p.Deleted))
    {
        <text>positions.push('</text>@position.Name<text>');</text>
    }

    options = '';

    for (var i = 0; i < positions.length; i++) {
        options += '<option value="' + positions[i] + '">';
    }

    document.getElementById('positions').innerHTML = options;

    // this is what provides validation for add-shift modal. it could be moved to separate file
    $(".datetimepicker-time-start").on("change.datetimepicker", function (e) {
        const endTimeDiv = this.parentElement.parentElement.getElementsByClassName('datetimepicker-time-end')[0];
        const endTimeInput = endTimeDiv.getElementsByTagName('INPUT')[0];
        let originalDate = moment(endTimeInput.value, 'HH:mm');
        $(endTimeDiv).datetimepicker('minDate', moment({ h: e.date.hour(), m: e.date.minutes() + 1 }));
        endTimeInput.value = originalDate.format('HH:mm');
    });

    $(".datetimepicker-time-end").on("change.datetimepicker", function (e) {
        const startTimeDiv = this.parentElement.parentElement.getElementsByClassName('datetimepicker-time-start')[0];
        const startTimeInput = startTimeDiv.getElementsByTagName('INPUT')[0];
        let originalDate = moment(startTimeInput.value, 'HH:mm');
        $(startTimeDiv).datetimepicker('maxDate', moment({ h: e.date.hour(), m: e.date.minutes() - 1 }));
        startTimeInput.value = originalDate.format('HH:mm');
    });

    $(".datetimepicker-date-start").on("change.datetimepicker", function (e) {
        const endDateDiv = this.parentElement.parentElement.getElementsByClassName('datetimepicker-date-end')[0];
        const endDateInput = endDateDiv.getElementsByTagName('INPUT')[0];
        let originalDate = moment(endDateInput.value, 'YYYY-MM-DD');
        $(endDateDiv).datetimepicker('minDate', moment(e.date, 'YYYY-MM-DD'));
        endDateInput.value = originalDate.format('YYYY-MM-DD');
    });

    $(".datetimepicker-date-end").on("change.datetimepicker", function (e) {
        const startDateDiv = this.parentElement.parentElement.parentElement.getElementsByClassName('datetimepicker-date-start')[0];
        const startDateInput = startDateDiv.getElementsByTagName('INPUT')[0];
        let originalDate = moment(startDateInput.value, 'YYYY-MM-DD');
        $(startDateDiv).datetimepicker('maxDate', moment(e.date, 'YYYY-MM-DD'));
        startDateInput.value = originalDate.format('YYYY-MM-DD');
    });
</script>